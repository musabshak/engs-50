https://thayer.github.io/engs50/Notes/search/
2
19985
<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Searching The Web</title>
  <meta name="description" content="In Engs 50 you will learn how to design & build large, reliable, maintainable, and understandable software systems.  In the process you will learn to program in C with Unix development tools.
">

  <link rel="shortcut icon" href="/engs50/50.png" />
  <link rel="stylesheet" href="/engs50/css/main.css">
  <link rel="canonical" href="/engs50/Notes/search/">
</head>


  <body>

    <header class="site-header">

    <a class="site-title" href="/engs50/">
      <img width=48 align=center src="/engs50/50.png" alt="icon">
      Engs50 (CS50)
    </a>

    <nav class="site-nav">
      [<a href="/engs50/Labs/">Labs</a>]
      [<a href="/engs50/Notes/">Notes</a>]
      [<a href="/engs50/Reading/">Reading</a>]
      [<a href="/engs50/Resources/">Resources</a>]
			[<a href="/engs50/Examples/">Examples</a>]
   </nav>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Searching The Web</h1>
  </header>

  <div class="post-content">
    <p>In the next series of Labs we will design, implement and test a command-line web-search tool called Tiny Search Engine (TSE) because it can be written in under <strong>2000</strong> lines of student-written C code (about 500 lines in each of four Labs 3-6).
Today we begin to discuss the concepts behind web search and the top-level design of TSE and its decomposition into three major components: crawler, indexer, and query.</p>

<p>In this lecture, we discuss some of the foundational issues associated with searching the web.
We also dicuss the overall architectural design of a more comprehensive search engine than TSE.</p>

<p>You should skim this classic paper about a web search engine:</p>

<blockquote>
  <p><em><a href="/engs50/Reading/searchingtheweb.pdf">Searching the Web</a>,</em> Arvind Arasu, Junghoo Cho, Hector Garcia-Molina, Andreas Paepcke, Sriram Raghavan (Stanford University). ACM Transactions on Internet Technology (TOIT), Volume 1, Issue 1 (August 2001).</p>
</blockquote>

<p>This paper gives insights into search-engine design.
You can skip the plots and deeper research material, but do your best to understand the text on the main components and design issues of a search engine.</p>

<h3 id="goals">Goals</h3>

<p>We plan to learn the following from today’s lecture:</p>

<ul>
  <li>How does search engine like Google search the web?</li>
  <li>A general search-engine architecture.</li>
  <li>URLs, webpages, HTML, HTTP, and keywords.</li>
  <li>‘Talking’ to the CS department webserver using HTTP.</li>
</ul>

<!-- Here's my Terminal [script](/engs50/Notes/search/script.txt) for today. -->

<h3 id="searching-the-web">Searching the Web</h3>

<p>How do you get information from the Web?
Searching the web is something we do every day with ease, but it’s technically challenging to implement because of the scale of the web and because pages change at dramatically different rates.
As of April 12, 2014 there were <strong>1.79 billion</strong> publicly available webpages on the “indexed web” according to <a href="http://www.worldwidewebsize.com">one estimate</a>.
I just looked at that web site on April 17, 2018: the site says the indexed web now contains at least <strong>4.86 billion pages!</strong> Even that number likely to be an underestimate, because many organizations have lots of internal webpages that aren’t indexed by the public search engines.</p>

<p>To get information about hiking in New Hampshire, I can use a search engine (such as Google) as an information retrieval system; it returns a list of links (URLs) to sites that have the keywords I specified embedded in them.
Conveniently, the search engine orders (ranks) the links so the most-relevant pages are near the top of the list.</p>

<p><img src="/engs50/Notes/search/hikenh.png" alt="Google search for *hiking &quot;new hampshire&quot;*" /></p>

<hr />

<p>Google responded to my query in 0.52 seconds with 8,960,000 matches found!
How is that possible?
How does Google search more than 4 billion web pages in half of a second?
Surely, Google does not actually search those pages for each user’s request.
Instead, it looks into a vast ‘index’ of the web, built earlier.
Given a new search term, it checks the index for pages known to have the word “hiking”, and again for those with the phrase “new hampshire”, and then intersects the two results to come up with a list.</p>

<p>How does Google rank the pages in the resulting list?
The solution is actually Google’s ‘secret sauce’, the “page-rank algorithm” developed by Brin and Page when they were grad students.
(Although the original algorithm was published, Google continues to refine and tweak it and keeps the details secret.)</p>

<p>When and how does Google build that index?
And how does it find all the pages on the web?
Google’s servers are constantly “crawling” the web: given one link (URL), download that page, find all the links in that page, and then go examine those pages - recursively.
As new (or updated) pages are found, they “index” each page by extracting the list of words used on that page, and then building a data structure that maps from <em>words</em> to <em>URLs</em>.</p>

<p>Later, a search query is broken into words, and each word is sought in the index, returning a set of URLs where that word appears.
For a multi-word query, they intersect the sets to find a set where all words appear.
Then they apply the page-rank algorithm to the set to produce a ranked list.</p>

<p>In April 2014, Google’s website said its index filled over 100 million gigabytes!
<strong>Check out this <a href="https://www.google.com/insidesearch/howsearchworks/crawling-indexing.html">nice video</a> from Google explaining how search engine works.</strong></p>

<h3 id="general-search-engine-architecture-arvind-2001">General search engine architecture [Arvind, 2001]</h3>

<p>Search engines like Google are complex, sophisticated, highly distributed systems.
Below we reproduce the general search engine architecture discussed in <em><a href="/engs50/Reading/searchingtheweb.pdf">Searching the Web</a>.</em></p>

<p><img src="searchenginearchitecture.png" alt="General search engine architecture [Arvind, 2001]" title="General search engine architecture [Arvind, 2001]" /></p>

<hr />

<p>The main components include parallel crawlers, crawler control (when and where to crawl), page repository, indexer, analysis, collection of data structures (index tables, structure, utility), and a query engine and ranking module.
Such a general architecture would take a significant amount of time to code.
In our TSE, we will implement a stripped down version of the main components.</p>

<h3 id="urls-html-and-keywords">URLs, HTML, and keywords</h3>

<p>Some terminology:</p>

<ul>
  <li><strong>URL</strong>, short for <em>Uniform Resource Locator</em>, is used to specify addresses of webpages and other resources on the web.
An example is <code class="highlighter-rouge">http://www.dartmouth.edu/index.html</code>, which refers to the <code class="highlighter-rouge">HTTP</code> network protocol, the  <code class="highlighter-rouge">www.dartmouth.edu</code> server, and the <code class="highlighter-rouge">index.html</code> file on that server.</li>
  <li><strong>HTML</strong>. Most web pages are written in HyperText Markup Language (HTML).
For a quick tutorial on HTML see this <em><a href="http://www.w3schools.com/html/html_intro.asp">Introduction to HTML</a></em>.
An HTML file is a text file with an <code class="highlighter-rouge">htm</code> or <code class="highlighter-rouge">html</code> file extension.
HTML pages can be created by tools or simply in an editor like emacs.
You will not need to write any HTML for this course.</li>
  <li><strong>tags</strong>. HTML uses “tags” to mark-up the text; for example <code class="highlighter-rouge">&lt;b&gt;this text would be bold&lt;/b&gt;</code>.
Most tags are enclosed in angle brackets, like <code class="highlighter-rouge">&lt;b&gt;</code>, and most come in matching pairs marking the beginning and ending of a region of text to which the tag applies; note the <code class="highlighter-rouge">&lt;b&gt;</code> and <code class="highlighter-rouge">&lt;/b&gt;</code> pair.</li>
</ul>

<p>We are interested collecting URLs from HTML files.
The HTML tag that forms a link and references a URL is called an ‘anchor’, or ‘a’ for short.
The tag <code class="highlighter-rouge">&lt;a&gt;</code> takes parameters, most importantly the <code class="highlighter-rouge">href</code> parameter:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.dartmouth.edu/index.html"</span><span class="nt">&gt;</span>Dartmouth home page<span class="nt">&lt;/a&gt;</span>
</code></pre></div></div>

<p>For the purpose of indexing the page, we need to find the ‘words’ in the page.
In most web pages, most of the content is outside the tags because the tags are there to format the content.
<strong>For TinySearchEngine, we define keywords as being outside of tags.</strong></p>

<p>So when TinySearchEngine downloads a webpage of HTML source it needs to parse the page to extract URLs (so it can crawl those URLs) and identify the words that users might be interested in running queries for.</p>

<p>Parsing HTML can be challenging, especially because so many pages on the web don’t follow the HTML standard cleanly.
We will provide you with a C function to parse the HTML.
(Feel free to write your own if you prefer).</p>

<p>For more information about HTML check out the old <a href="http://www.w3.org/TR/REC-html40/about.html">HTML 4 specification</a> or the brand new <a href="http://www.w3.org/TR/html5/">HTML 5 specification</a>.</p>

<h3 id="talk-to-a-webserver-using-hypertext-transfer-protocol-http">Talk to a webserver using HyperText Transfer Protocol (HTTP)</h3>

<p>The <a href="http://www.w3.org/Protocols/">HyperText Transfer Protocol (HTTP)</a> is used between your client browser and the server to transfer HTML files.
HTTP itself is a very simple, stateless, request/response protocol that get its reliable underlying transport from TCP (Transmission Control Protocol) on top of IP (Internet Protocol).
(Go take CS60 to learn more about networking!)</p>

<p>The basic HTTP protocol is that the client sends a request called a <code class="highlighter-rouge">GET</code> and the server responds with a response.
Web servers ‘listen’ for requests on the well-known TCP port 80.</p>

<p>We have to first connect to the server and open up a reliable stream to host <code class="highlighter-rouge">www.cs.dartmouth.edu</code> at port 80.
We could write some fancy code to do this, but (in typical Unix style) there is already a tool we can use: <code class="highlighter-rouge">telnet</code>, a program that simply makes a TCP/IP connection to a given host and port, and connects our terminal’s keyboard and screen to that connection so we can interactively write to the remote server listening at that port.</p>

<p>We can thus type an HTTP <code class="highlighter-rouge">GET</code> request by hand:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[cs50@flume ~]$ telnet www.cs.dartmouth.edu 80
Trying 129.170.213.101...
Connected to www.cs.dartmouth.edu.
Escape character is '^]'.
GET /~cs50/index.html HTTP/1.1           <span class="nt">&lt;</span><span class="err">==</span> <span class="na">I</span> <span class="na">typed</span> <span class="na">this</span>
<span class="na">HOST:</span> <span class="na">www</span><span class="err">.</span><span class="na">cs</span><span class="err">.</span><span class="na">dartmouth</span><span class="err">.</span><span class="na">edu</span>               <span class="err">&lt;==</span> <span class="na">and</span> <span class="na">this</span>
                                         <span class="err">&lt;==</span> <span class="na">and</span> <span class="na">a</span> <span class="na">blank</span> <span class="na">line</span>
<span class="na">HTTP</span><span class="err">/</span><span class="na">1</span><span class="err">.</span><span class="na">1</span> <span class="na">200</span> <span class="na">OK</span>
<span class="na">Date:</span> <span class="na">Wed</span><span class="err">,</span> <span class="na">19</span> <span class="na">Apr</span> <span class="na">2017</span> <span class="na">16:22:32</span> <span class="na">GMT</span>
<span class="na">Server:</span> <span class="na">Apache</span><span class="err">/</span><span class="na">2</span><span class="err">.</span><span class="na">4</span><span class="err">.</span><span class="na">23</span> <span class="err">(</span><span class="na">Fedora</span><span class="err">)</span>
<span class="na">Last-Modified:</span> <span class="na">Wed</span><span class="err">,</span> <span class="na">19</span> <span class="na">Apr</span> <span class="na">2017</span> <span class="na">14:57:28</span> <span class="na">GMT</span>
<span class="na">ETag:</span> <span class="err">"</span><span class="na">c50-54d863e326600</span><span class="err">"</span>
<span class="na">Accept-Ranges:</span> <span class="na">bytes</span>
<span class="na">Content-Length:</span> <span class="na">3152</span>
<span class="na">Connection:</span> <span class="na">close</span>
<span class="na">Content-Type:</span> <span class="na">text</span><span class="err">/</span><span class="na">html</span><span class="err">;</span> <span class="na">charset=</span><span class="s">UTF-8</span>

<span class="err">&lt;!</span><span class="na">DOCTYPE</span> <span class="na">html</span><span class="nt">&gt;</span>
<span class="nt">&lt;html&gt;</span>

  <span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;title&gt;</span>CS50 Overview<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">content=</span><span class="s">"In Computer Science 50 you will learn how to design &amp; build large,  reliable, maintainable, and understandable software systems.  In the process you will learn to program in C with Unix development tools.

. . .
</span></code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      [&lt;a href="https://canvas.dartmouth.edu/courses/14815"&gt;Canvas&lt;/a&gt;]
      [&lt;a href="https://piazza.com/dartmouth/spring2017/cosc050sp17/home"&gt;Piazza&lt;/a&gt;]
      [&lt;a href="/~cs50/Schedule.pdf"&gt;Schedule&lt;/a&gt;]
      [&lt;a href="http://www.cs.dartmouth.edu/~cs50/Logistics/"&gt;Logistics&lt;/a&gt;]
      [&lt;a href="http://www.cs.dartmouth.edu/~cs50/Lectures/"&gt;Lectures&lt;/a&gt;]
      [&lt;a href="http://www.cs.dartmouth.edu/~cs50/Reading/"&gt;Reading&lt;/a&gt;]
      [&lt;a href="http://www.cs.dartmouth.edu/~cs50/examples/"&gt;Examples&lt;/a&gt;]
      [&lt;a href="http://www.cs.dartmouth.edu/~cs50/Sections/"&gt;Sections&lt;/a&gt;]
      [&lt;a href="http://www.cs.dartmouth.edu/~cs50/Labs/"&gt;Labs&lt;/a&gt;]
. . .
</code></pre></div></div>

<p>Try it yourself!
Make sure you hit carriage return twice after typing in
<code class="highlighter-rouge">HOST:  www.cs.dartmouth.edu</code>
since the HTTP protocol wants an empty line to indicate that you’re finished.</p>

<p>The web server responds with a few lines of HTTP syntax; the first line reports status code <code class="highlighter-rouge">200</code> with human-readable equivalent <code class="highlighter-rouge">OK</code>.
The next few lines provide the date, the server version, the last-modified date for the file returned, and some other stuff describing the content as HTML.
After a blank line, the contents of the file we requested (the CS50 home page).
I snipped out most of it, but you can see the anchor tags that appear at the top of every CS50 page.
Notice the URLs for Canvas, Piazza, and links to other folders and files within the <code class="highlighter-rouge">~cs50</code> folder.</p>

<p>You happen to have access to the files used by this web server!
This server is configured to rewrite URLs of the form <code class="highlighter-rouge">/~user/...</code> to pathnames of the form <code class="highlighter-rouge">~user/public_html/...</code>.
So if you ssh to <code class="highlighter-rouge">flume</code> or any of the CS50 Unix machines you can <code class="highlighter-rouge">cd ~cs50/public_html/</code> and poke around at the HTML files there.</p>

<p>Most web pages will include many links, and sometimes will include the same link twice.
Furthermore, when exploring a set of web pages, those web pages often link to each other (for example, all the CS50 pages link to the CS50 ‘home’, and that page links directly or indirectly to all of those pages).</p>

<p>The web is a “directed graph”, not a tree.
Any effort to ‘crawl’ the web, therefore, must use something like breadth-first or depth-first search to explore the graph, avoiding the effort (and infinite loops!) that occur when encountering a link already found earlier in the crawl.</p>

<p>In our TinySearchEngine we will rely on <code class="highlighter-rouge">curl</code> (and the <code class="highlighter-rouge">libcurl</code> library) to retrieve webpages.</p>

<p>We can experiment a bit using the command-line version of <code class="highlighter-rouge">curl</code>.
Let’s use <code class="highlighter-rouge">curl</code> to download the CS50 homepage count the number of URLs.
A crude approach would be to pipe the output of <code class="highlighter-rouge">curl</code> (i.e., the HTML from the web page) into <code class="highlighter-rouge">grep</code> and then count the lines.
(This approach will under-count if there are multiple <code class="highlighter-rouge">href</code> links on the same line.)  There are at least 17 links on that page.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>cs50@flume ~]<span class="nv">$ </span>curl <span class="nt">-s</span> http://www.cs.dartmouth.edu/~cs50/ | <span class="nb">grep</span> <span class="nt">-i</span> href | wc <span class="nt">-l</span>
17
</code></pre></div></div>

<h2 id="activity">Activity</h2>

<p>In today’s <a href="activity.html">activity</a> your group will start envisioning a design for the TSE Crawler.</p>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Engs50 (CS50) -- Dartmouth College</h2>

    <p> <font size=-1>
    	This version of the course is based upon those designed by
    	Professors Palmer, Kotz, Zhou, Campbell, and Balkcom.
	I am deeply indebted to these outstanding educators.
    -- <a href="https://engineering.dartmouth.edu/people/faculty/stephen-taylor/">Stephen Taylor</a>
       </font>
    </p>
    <p><small>This page was last updated on <strong>2018-10-10</strong> at <strong>18:07</strong>.</small></p>
  </div>

</footer>


  </body>

</html>
E.md
<span class="c"># Binary-tree demo code</span>
<span class="c">## Version 6: use function pointers and add tree_print()</span>
 <span class="k">*</span> demonstrates use of <span class="k">function </span>pointers
 <span class="k">*</span> adds tree_print<span class="o">()</span> <span class="k">function</span>
 <span class="k">*</span> hints at how one might support tree_delete<span class="o">()</span> <span class="k">function</span>
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span><span class="nb">ls
</span>Makefile  README.md  tree.c  tree.h  treetest.c
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git status
On branch master
Untracked files:
  <span class="o">(</span>use <span class="s2">"git add &lt;file&gt;..."</span> to include <span class="k">in </span>what will be committed<span class="o">)</span>

	README.md

nothing added to commit but untracked files present <span class="o">(</span>use <span class="s2">"git add"</span> to track<span class="o">)</span>
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git add README.md
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git status
On branch master
Changes to be committed:
  <span class="o">(</span>use <span class="s2">"git reset HEAD &lt;file&gt;..."</span> to unstage<span class="o">)</span>

	new file:   README.md

<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git commit <span class="nt">-m</span> <span class="s2">"Added README"</span>
<span class="o">[</span>master 330e2e1] Added README
 1 file changed, 5 insertions<span class="o">(</span>+<span class="o">)</span>
 create mode 100644 README.md
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="err">$</span>
</code></pre></div></div>

<p><strong>Hint:</strong> If you have several new, modified, or deleted files to <code class="highlighter-rouge">git add</code>, you can use <code class="highlighter-rouge">git add --all</code></p>

<blockquote>
  <p>Notice that I used <code class="highlighter-rouge">README.md</code> rather than <code class="highlighter-rouge">README</code> above.
A file with extension <code class="highlighter-rouge">.md</code> is assumed to be a text file in Markdown syntax, which provides very simple (and readable) markup for headings, lists, italics, bold, and code snippets.
(This course website is written in Markdown.) Many VCS web portals (like our Gitlab and the popular Github) allow you to browse the files in your repository and render Markdown format, making such files much nicer to look at.
Markdown is easy to learn; see <a href="/engs50/Resources/#markdown">Markdown resources</a>.</p>
</blockquote>

<h3 id="recovering-files">Recovering files</h3>

<p>Git has some characteristics of a backup system.
If you accidentally remove a file, you can recover it from the most recent commit by asking Git to check it out from that commit:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rm program.c  <span class="c"># oops! I meant to rm program.c~</span>
<span class="nv">$ </span>git checkout program.c  <span class="c"># as of the last commit</span>
</code></pre></div></div>

<p>For more about how you can use this feature to “roll back” to an earlier version of the code, see below.</p>

<h3 id="ignoring-files">Ignoring Files</h3>

<p>Git works well with normal files, but executables and binary-format files (like images) can present a challenge.
In addition, there are often certain files that you do not want to be under version control, like temporary files from your favorite editor.
(As a general rule, you should not commit any <em>derived files</em> to a repo; for example, any files built by a Makefile; the source files live in the repo, and the derived files are rebuilt by anyone using the repo.) You should configure Git to ignore those files, so they will not be added to your repo.</p>

<p>Some filename extensions are so commonly used to refer to derived files that we configure Git to ignore them in all of our repos.
<strong>Do it now!</strong>  Create a file <code class="highlighter-rouge">~/.gitignore_global</code> with the following contents:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Object files and libraries
*.o
*.a

# Emacs
*~
\#*\#
.\#*

# debugger symbols
*.dSYM

# MacOS X
.DS_Store
.AppleDouble
.LSOverride
Icon
._*
.Spotlight-V*
.Trashes
</code></pre></div></div>

<p>To make it easy, just copy our file:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp ~cs50/.gitignore ~
</code></pre></div></div>

<p>Github maintains a list of common <a href="https://github.com/github/gitignore">ignore files</a>, if you want to get more ideas.</p>

<p>Then you should tell Git about project-specific files that should be ignored.
At a minimum, this list would include the ‘executable binary’ file that is produced as a result of compiling your program.
As a rule of thumb, you should tell Git to ignore anything that <code class="highlighter-rouge">make</code> builds and <code class="highlighter-rouge">make clean</code> deletes.</p>

<p>We’ll create a <code class="highlighter-rouge">.gitignore</code> file for our new repo.
Below, I focus on the need to ignore the executable file <code class="highlighter-rouge">treetest</code> that builds with <code class="highlighter-rouge">make</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span><span class="nb">echo </span>treetest <span class="o">&gt;</span> .gitignore
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git status
On branch master
Untracked files:
  <span class="o">(</span>use <span class="s2">"git add &lt;file&gt;..."</span> to include <span class="k">in </span>what will be committed<span class="o">)</span>

	.gitignore

nothing added to commit but untracked files present <span class="o">(</span>use <span class="s2">"git add"</span> to track<span class="o">)</span>
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git add .gitignore
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git commit <span class="nt">-m</span> <span class="s2">"ignore executable"</span>
<span class="o">[</span>master 9f01c00] ignore executable
 1 file changed, 1 insertion<span class="o">(</span>+<span class="o">)</span>
 create mode 100644 .gitignore
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="err">$</span>
</code></pre></div></div>

<p>I didn’t have to add and commit the <code class="highlighter-rouge">.gitignore</code> file for Git to make use of it; I just didn’t want to forget to put it into the repo.
That way, anyone else who later uses this project repo will also get the same <code class="highlighter-rouge">.gitignore</code> file.</p>

<p>Now let’s make the executable and see whether Git ignores it.
[Not shown: I first made a small change to <code class="highlighter-rouge">treetest.c</code>].</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>make
gcc <span class="nt">-Wall</span> <span class="nt">-pedantic</span> <span class="nt">-std</span><span class="o">=</span>c11 <span class="nt">-ggdb</span>   <span class="nt">-c</span> <span class="nt">-o</span> treetest.o treetest.c
gcc <span class="nt">-Wall</span> <span class="nt">-pedantic</span> <span class="nt">-std</span><span class="o">=</span>c11 <span class="nt">-ggdb</span>   <span class="nt">-c</span> <span class="nt">-o</span> tree.o tree.c
gcc <span class="nt">-Wall</span> <span class="nt">-pedantic</span> <span class="nt">-std</span><span class="o">=</span>c11 <span class="nt">-ggdb</span> treetest.o tree.o  <span class="nt">-o</span> treetest
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span><span class="nb">ls
</span>Makefile  README.md  tree.c  tree.h  tree.o  treetest<span class="k">*</span>	treetest.c  treetest.o
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git status
On branch master
Changes not staged <span class="k">for </span>commit:
  <span class="o">(</span>use <span class="s2">"git add &lt;file&gt;..."</span> to update what will be committed<span class="o">)</span>
  <span class="o">(</span>use <span class="s2">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="k">in </span>working directory<span class="o">)</span>

	modified:   treetest.c

Untracked files:
  <span class="o">(</span>use <span class="s2">"git add &lt;file&gt;..."</span> to include <span class="k">in </span>what will be committed<span class="o">)</span>

	tree.o
	treetest.o

no changes added to commit <span class="o">(</span>use <span class="s2">"git add"</span> and/or <span class="s2">"git commit -a"</span><span class="o">)</span>
</code></pre></div></div>

<p>Uh-oh.
It looks like Git properly ignored <code class="highlighter-rouge">treetest</code> but did not ignore the <code class="highlighter-rouge">.o</code> files.
I must have skipped over the <a href="#ignoring-files">directions above</a>.
We can explicitly ignore them in this directory:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;&gt;</span> .gitignore
<span class="k">*</span>.o
^D
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git status
On branch master
Changes not staged <span class="k">for </span>commit:
  <span class="o">(</span>use <span class="s2">"git add &lt;file&gt;..."</span> to update what will be committed<span class="o">)</span>
  <span class="o">(</span>use <span class="s2">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="k">in </span>working directory<span class="o">)</span>

	modified:   .gitignore
	modified:   treetest.c

no changes added to commit <span class="o">(</span>use <span class="s2">"git add"</span> and/or <span class="s2">"git commit -a"</span><span class="o">)</span>
</code></pre></div></div>

<p>It worked; now I will commit all modified files with <code class="highlighter-rouge">commit -a</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git commit <span class="nt">-a</span> <span class="nt">-m</span> <span class="s2">"tweak the test script"</span>
<span class="o">[</span>master 153995e] tweak the <span class="nb">test </span>script
 2 files changed, 5 insertions<span class="o">(</span>+<span class="o">)</span>, 4 deletions<span class="o">(</span>-<span class="o">)</span>
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>
</code></pre></div></div>

<h3 id="removing-files">Removing Files</h3>

<p>The <code class="highlighter-rouge">git rm</code> command is the command to remove files from the repository.
For example, you may rearrange your code and some source files are no longer needed; instead of <code class="highlighter-rouge">rm</code> you use <code class="highlighter-rouge">git rm</code> to remove the file from both your working directory and from the repository.
(Prior versions of the file(s) are still in the repository, so you can always get the file back.)</p>

<blockquote>
  <p>As git-status output sometimes suggests, if you want to remove something from the staging area you use the <code class="highlighter-rouge">git rm --cached &lt;file&gt;</code> command to remove staged files.
This command doesn’t remove the file from your directory, or from the repository - it’s just the opposite of <code class="highlighter-rouge">git add</code>.</p>
</blockquote>

<h3 id="committing-changes">Committing Changes</h3>

<p>When you have made some changes and staged them, then you are ready to commit those changes (roughly) permanently.
Each commit should be accompanied by a message explaining what changes have been made.
The command to accomplish this is <code class="highlighter-rouge">git commit -m "&lt;message&gt;"</code>, as we saw in the examples above.</p>

<p>If you run the <code class="highlighter-rouge">git commit</code> command without the <code class="highlighter-rouge">-m</code> option, you will be taken to your default editor to enter a commit message.
If you commit too early and want to add something to the same commit, then you can use the <code class="highlighter-rouge">git commit --amend</code> command.</p>

<p>The commit message is very important, both to you and to your colleagues working with you.
Your commits should be fairly granular with a straightforward <em>present tense</em> commit message.
We encourage the use of <em>present tense</em> since you should think of the commit message as describing what the commit does.
The commit messages become even more important as you work with a team, particularly when the members are geographically distributed.</p>

<h3 id="best-practice-make-atomic-changes">Best Practice: Make atomic changes</h3>

<p>Git doesn’t care why files are changing.
It just tracks the content as it changes, allowing you to choose how to use it the best way.
Git actions are atomic, and your changes should be also.
If you move a function from one file to another that could be two commits: one to delete it in file A, and another to add it to file B.
This is ok with Git, but between the two commits the function is missing entirely, so a later build based on that the code base at the first commit would not work.
Instead, commit the new version of both files in the same commit.</p>

<p>Similarly, if you need to make several unrelated changes to various files in your project, run <code class="highlighter-rouge">git commit</code> separately for each set of changes, each commit with a different message, so that the message is relevant to the files being committed.</p>

<h3 id="git-diff">git diff</h3>

<p>How can you tell what has changed since your last commit?
With <code class="highlighter-rouge">git diff</code>!
Below, I edit the <code class="highlighter-rouge">README.md</code> file and then use <code class="highlighter-rouge">git diff</code> to show me what changed.
Just like <code class="highlighter-rouge">diff</code>, it prints a little bit of context and then uses lines beginning with <code class="highlighter-rouge">+</code> and <code class="highlighter-rouge">-</code> to show added and removed lines, respectively.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>emacs README.md
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git diff
diff <span class="nt">--git</span> a/README.md b/README.md
index ce0057f..4eb3662 100644
<span class="nt">---</span> a/README.md
+++ b/README.md
@@ <span class="nt">-4</span>,5 +4,8 @@
  <span class="k">*</span> adds tree_print<span class="o">()</span> <span class="k">function</span>
  <span class="k">*</span> hints at how one might support tree_delete<span class="o">()</span> <span class="k">function</span>

-# This code is now on Gitlab!
+I removed a line and added this paragraph instead.
+It will demonstrate how <span class="sb">`</span>diff<span class="sb">`</span> can show you the differences
+between the current version and the last-committed version.
+
</code></pre></div></div>

<p>You can also add a specific filename, like <code class="highlighter-rouge">git diff Makefile</code> if you just want to see differences for one file rather than all files in the repo.</p>

<blockquote>
  <p>If you find the output of <code class="highlighter-rouge">git diff</code> mangled, it could be because of an incompatibility between <code class="highlighter-rouge">git</code>, the ‘pager’ program (<code class="highlighter-rouge">less</code>), the <code class="highlighter-rouge">ssh</code> connection, and your terminal program.</p>
</blockquote>

<blockquote>
  <p>I worked around it by telling git to use cat as my pager:</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	git config <span class="nt">--global</span> core.pager <span class="nb">cat</span>
</code></pre></div></div>

<h3 id="git-tags">git tags</h3>

<p><em>Beginners can ignore this feature for now.</em></p>

<p>Once you’ve achieved some milestone, such as a deliverable or release, you need some mechanism for marking it in your get log history.
If you print the Git log you’ll see the hash codes on the left side that are used to identify each commit.
Clearly, it would be unreasonable to expect everyone to remember that 5ba4851 was release 1.0.
for this purpose you use the <code class="highlighter-rouge">git tag</code> command.
This places a marker in the get log with the name you specify.
You should try to use this command only when you’re in a committed, up-to-date state.
Later, when you need to reconstruct a particular release, you can use this tag in the <code class="highlighter-rouge">git checkout</code> command.</p>

<blockquote>
  <p>The example above is for a “lightweight” tag - one that is just a name and a location in the Git history.
Another is the “annotated tag” just like the commit command does.
These are generally used to note major releases since the annotation can include the release name, release notes, and other information related to the release.</p>
</blockquote>

<p>For a nice overview of how to use this feature, please see the <a href="tags.html">“Git Tag Extra”</a> that we’ve added.</p>

<h3 id="git-stashes">git stashes</h3>

<p><em>Beginners can ignore this feature for now.</em></p>

<p>It’s a common occurrence to be happily working on the next release of the code when a high-priority critical situation comes up with an important customer.
The boss wants you to stop what you’re doing and fix the problem.
You’re anxious to fix it, but what about all the work you have in your working directory?
Where should you save it so that you can do a <code class="highlighter-rouge">git checkout</code> of the code that corresponds to the release the customer is running?
The answer is to do a <code class="highlighter-rouge">git stash</code>, which will save everything that isn’t committed, and reset the directory to the most recent committed version.</p>

<p>Once the high priority work is completed, you can restore what you had with <code class="highlighter-rouge">git stash apply</code> and your previous work will reappear.
Once you’re finished with a stash, you should delete it using <code class="highlighter-rouge">git stash drop</code> which will delete the last stash.
You may have multiple stashes saved (see them using the <code class="highlighter-rouge">git stash list</code> command), but <strong>do not</strong> use the stash for version control or backup!</p>

<h3 id="rolling-back-to-a-previous-commit">Rolling back to a previous commit</h3>

<p><em>Beginners should ignore this feature for now.</em></p>

<p><em>Thanks to Travis Peters for this tip.</em></p>

<p>To “roll back” your repository to a specified state (i.e., a particular commit) you’ll need to use the <code class="highlighter-rouge">git reset</code> command.</p>

<p><strong>WARNING:</strong> Please exercise caution when running these commands as this is not something you can undo later if you don’t follow these instructions!
This tutorial assumes you are currently on the <code class="highlighter-rouge">master</code> branch.</p>

<p>First, we want to ensure that we can come back to this state of our repository at a later point should we need to do so.
A commit and its predecessors are always accessible so long as we have a pointer to the most recent commit in that “branch”.
So, we first create a branch that points to the most recent commit in our current branch (ideally you are on the “master” branch right now):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git branch myoldhead
</code></pre></div></div>

<p>Next, we use the <code class="highlighter-rouge">git reset</code> command which allows you to <em>reset</em> your current <code class="highlighter-rouge">HEAD</code> to some specified state.
According to the man page (<code class="highlighter-rouge">git help reset</code>), the <code class="highlighter-rouge">--hard</code> flag does the following:</p>
<blockquote>
  <p>Resets the index and working tree.
Any changes to tracked files in the working tree since <commit> are discarded.</commit></p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git reset --hard &lt;tag/branch/commit hash-id&gt;
</code></pre></div></div>
<p>Running this command effectively sets your <code class="highlighter-rouge">HEAD</code> back to the tag/branch/commit that you specify and completely clears out your working directory and index (i.e., staging area).</p>

<p>Finally, if you wish to commit this state of your local repository so that your remote repository is synchronized (i.e., the remote repository also points back to the commit that you just reset your local repository back to), you need to <code class="highlighter-rouge">git push</code> with the <code class="highlighter-rouge">-f</code> flag which will forcefully overwrite your remote repository (without the <code class="highlighter-rouge">-f</code> flag, git will complain about your current branch being “behind”; this is expected in our case).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push -f
</code></pre></div></div>

<p><strong>A Couple of Notes:</strong></p>

<ul>
  <li>If you decide that the <code class="highlighter-rouge">myoldhead</code> branch is no longer needed and you really don’t want to keep the changes, you can delete the branch (<code class="highlighter-rouge">git branch -D</code>) and all of the commits that go with it by running the following command:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch -D myoldhead
</code></pre></div></div>

<ul>
  <li>When referencing commits, such as in the <code class="highlighter-rouge">git reset</code> command above, you don’t have to copy/paste (or write out!) the whole commit.
Large (cryptographic) hashes are used by git for data integrity purposes (the details of which beyond the scope of these notes).
What we are concerned with, however, is <em>uniqueness</em> of these commits.
While not guaranteed, it is extremely unlikely that the (SHA-1) hashes that are generated for different commits will be the same.
Thus, when referring to commits, we need only tell Git enough of the commit hash that it can be confident that you have uniquely identified a specific commit.
<strong><em>In practice, you’ll see people only use the first 7-10 characters of a git hash to uniquely identify some tag/branch/commit</em></strong>.</li>
</ul>

<h2 id="other-handy-git-features">Other handy git features</h2>

<p>Git has many, many more features than we have detailed here.
We have only scratched the surface with the commands necessary to work collaboratively on your class project.
The interested student is encouraged to explore the provided resources.
Keywords/commands to investigate: <em>show</em>, <em>diff</em>, <em>branch</em>, and <em>rebase</em>.
For example, here’s a git <em>branch/merge</em> example, from the folks who brought you <a href="http://gitgraphjs.com/"><em>gitgraph.js</em></a>: <a href="/engs50/Notes/git/gitgraph-sample.pdf">PDF</a>.</p>

<h2 id="cs-gitlab">CS Gitlab Server</h2>

<p>The CS GitLab server is hosted at: <a href="https://gitlab.cs.dartmouth.edu/"><code class="highlighter-rouge">https://gitlab.cs.dartmouth.edu/</code></a>.
We’re using GitLab (instead of public servers elsewhere on the Internet) because it allows you to maintain your own private repositories and because it provides cool tools.
For example, GitLab includes a graphical, web-based way of exploring your repositories as shown below.</p>

<p>You must register for a userid and then create a repository for Lab4 using the instructions that follow.</p>

<p>To get started with GitLab, follow these steps:</p>

<ol>
  <li>Use a browser to go to <a href="https://gitlab.cs.dartmouth.edu/"><code class="highlighter-rouge">https://gitlab.cs.dartmouth.edu/</code></a></li>
  <li>If you don’t already have a GitLab userid, <strong><em>create one that is identical to your CS login name</em></strong>.</li>
  <li>
    <p>When the GitLab userid is created, go back and login.
Here is the opening screen when a new user logs in<br />
<img src="gitlab-newuser.png" alt="" />
and here’s what my opening screen looks like. <br />
<img src="gitlab-veteran.png" alt="" /></p>
  </li>
  <li>
    <p>All of our repositories are in a Gitlab Group.  Click on the Groups tab near the top.</p>
  </li>
  <li>
    <p>Click on our group <em>CS50-S18</em> to expand it.
<img src="gitlabgroup2.jpeg" alt="" /></p>
  </li>
  <li>
    <p>Click on the <em>TSE</em> subgroup to open it.
<img src="gitlabgroup3.jpeg" alt="" /></p>
  </li>
  <li>
    <p>Click on the green “New Project” button.
<img src="gitlabgroup4.jpeg" alt="" /></p>
  </li>
  <li>
    <p>Fill out the form by giving the project a name (required) and description (optional).
<strong>Ensure the project is marked Private.</strong> <img src="gitlabgroup5.jpeg" alt="" /></p>
  </li>
  <li>
    <p>Now the project has been successfully created and appears like this: <img src="gitlabgroup6.jpeg" alt="" /></p>
  </li>
  <li>
    <p>Click on the <code class="highlighter-rouge">SSH</code> pop-up to change it to <code class="highlighter-rouge">HTTPS</code>.</p>
  </li>
  <li>
    <p>Scroll down to see the command-line instructions for using this project: <img src="gitlab4.png" alt="" /></p>
  </li>
  <li>Let’s assume you had already created a local git repository using the lecture notes above. Look at the instructions under <em>Existing Git repository.</em>
Copy the <code class="highlighter-rouge">git remote add origin</code> command you see there.</li>
  <li>Go to your Terminal window, and <code class="highlighter-rouge">cd</code> to the directory where you had earlier set up a local repository.
Paste the <code class="highlighter-rouge">git remote add origin</code> command.
This command ties your local repository to the new ‘remote’ you created on Gitlab, giving this relationship the name ‘origin’.</li>
  <li>Then copy and paste the command <code class="highlighter-rouge">git push -u origin master</code>.
This pushes your local repository’s ‘master’ branch to the remote known as ‘origin’.</li>
  <li>Enter your Gitlab username and password.</li>
  <li>Back in the Gitlab browser window, let’s explore the files now there.
Click on the little ‘home’ icon on the left side, then on the little ‘files’ icon.
You should see the files of your new project.
Notice, below, that it renders the <code class="highlighter-rouge">README.md</code> file nicely.
<img src="gitlab5.png" alt="" /></li>
</ol>

<p>Suppose the first thing you want to do is update the README.md file.
So you edit it, <code class="highlighter-rouge">git add</code>, and <code class="highlighter-rouge">git commit</code> it.
Now a git status shows you’re ready to push to the remote.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;&gt;</span> README.md

<span class="c"># This code is now on Gitlab!</span>

<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git status
On branch master
Your branch is up-to-date with <span class="s1">'origin/master'</span><span class="nb">.</span>
Changes not staged <span class="k">for </span>commit:
  <span class="o">(</span>use <span class="s2">"git add &lt;file&gt;..."</span> to update what will be committed<span class="o">)</span>
  <span class="o">(</span>use <span class="s2">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="k">in </span>working directory<span class="o">)</span>

	modified:   README.md

no changes added to commit <span class="o">(</span>use <span class="s2">"git add"</span> and/or <span class="s2">"git commit -a"</span><span class="o">)</span>
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git add README.md
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git commit <span class="nt">-m</span> <span class="s2">"updated README"</span>
<span class="o">[</span>master c19159a] updated README
 1 file changed, 3 insertions<span class="o">(</span>+<span class="o">)</span>
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git push
Counting objects: 3, <span class="k">done</span><span class="nb">.</span>
Delta compression using up to 8 threads.
Compressing objects: 100% <span class="o">(</span>3/3<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
Writing objects: 100% <span class="o">(</span>3/3<span class="o">)</span>, 322 bytes | 0 bytes/s, <span class="k">done</span><span class="nb">.</span>
Total 3 <span class="o">(</span>delta 2<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>
To https://dfkotz@gitlab.cs.dartmouth.edu/dfkotz/binary-tree.git
   45993ff..c19159a  master -&gt; master
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>git status
On branch master
Your branch is up-to-date with <span class="s1">'origin/master'</span><span class="nb">.</span>
nothing to commit, working directory clean
<span class="o">[</span>kotz@flume ~/cs50/labs/tree6]<span class="nv">$ </span>
</code></pre></div></div>

<p>Jump back to the browser and hit ‘refresh’ to see the new <code class="highlighter-rouge">README</code>.
Cool!
<img src="gitlab6.png" alt="" /></p>

<h2 id="why-is-git-always-asking-for-my-password">Why is Git always asking for my password?</h2>

<p>Because it must authenticate you to Gitlab.
If you use the HTTPS-style URLs, you need to enter your Gitlab password.
If you use the SSH-style URLs, you need to enter the passphrase you gave SSH when you generated the keypair.
We now recommend that you use SSH-style URLs.
The former method is a little tricky but worth the effort to set up.
Read about <a href="/engs50/Resources/gitlab-ssh.html">how to set up Gitlab for SSH</a>.</p>

<h2 id="activity">Activity</h2>

<p>In today’s <a href="activity.html">activity</a>, each group sets up a shared repo on Gitlab.</p>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Engs50 (CS50) -- Dartmouth College</h2>

    <p> <font size=-1>
    	This version of the course is based upon those designed by
    	Professors Palmer, Kotz, Zhou, Campbell, and Balkcom.
	I am deeply indebted to these outstanding educators.
    -- <a href="https://engineering.dartmouth.edu/people/faculty/stephen-taylor/">Stephen Taylor</a>
       </font>
    </p>
    <p><small>This page was last updated on <strong>2018-10-10</strong> at <strong>18:07</strong>.</small></p>
  </div>

</footer>


  </body>

</html>
